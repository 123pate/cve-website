<template>
  <aside class="menu">
    <p class="menu-label cve-capitalize-first-letter">Table of Contents</p>
    <ol class="menu-list cve-capitalize-first-letter">
      <li v-for="(sectionObj, index) in nav.pageSections" :key="index">
        <router-link :to="'#' + sectionObj.sectionId">{{ sectionObj.sectionTitle }}</router-link>
        <ol>
          <li v-for="(subSectionObj, index) in sectionObj.subSections" :key="index">
          <router-link :to="'#' + subSectionObj.subSectionId"
          v-bind:class="{'cve-subSectionHasChildren': subSectionObj.subSubSections.length>0}">{{ subSectionObj.subSectionTitle }}</router-link>
          <b-collapse animation="slide" :open="isOpen == index" @open="isOpen = index">
          <template #trigger="props">
            <div class="cve-toc-subSection-header" role="button">
            <a v-if="subSectionObj.subSubSections.length>0" class="cve-accordion-icon">
               <b-icon
                pack="fas"
                :icon="props.open ? 'caret-down' : 'caret-up'">
               </b-icon>
            </a>
            </div>
            </template>

            <ol style="list-style-type: decimal;">
             <li v-for="(subSubSectionObj, index) in subSectionObj.subSubSections" :key="index">
             <router-link :to="'#' + subSubSectionObj.subSubSectionId">{{ subSubSectionObj.subSubSectionTitle }}</router-link>
            </li>
           </ol> <!-- end page subSubSection list -->
        </b-collapse>
      </li>
     </ol> <!-- end page subSection list -->
    </li>
   </ol> <!-- end page section list -->
    <ul class="menu-list cve-capitalize-first-letter">
      <li v-for="(sectionObj, index) in nav.appendices" :key="index">
        <router-link class="pl-0" :to="'#' + sectionObj.sectionId">{{ sectionObj.sectionTitle }}</router-link>
        <ul>
          <li v-for="(subSectionObj, index) in sectionObj.subSections" :key="index">
          <router-link class="pl-0" :to="'#' + subSectionObj.subSectionId"
          v-bind:class="{'cve-subSectionHasChildren': subSectionObj.subSubSections.length>0}">{{ subSectionObj.subSectionTitle }}</router-link>
          <b-collapse animation="slide" :open="isOpen == index" @open="isOpen = index">
          <template #trigger="props">
            <div class="cve-toc-subSection-header" role="button">
            <a v-if="subSectionObj.subSubSections.length>0" class="cve-accordion-icon">
               <b-icon
                pack="fas"
                :icon="props.open ? 'caret-down' : 'caret-up'">
               </b-icon>
            </a>
            </div>
            </template>

            <ul style="list-style-type: decimal;">
             <li v-for="(subSubSectionObj, index) in subSectionObj.subSubSections" :key="index">
             <router-link :to="'#' + subSubSectionObj.subSubSectionId">{{ subSubSectionObj.subSubSectionTitle }}</router-link>
            </li>
           </ul> <!-- end appendix subSubSection list -->
        </b-collapse>
      </li>
     </ul> <!-- end appendix subSection list -->
    </li>
   </ul> <!-- end appendix section list -->

  </aside>
</template>

<script>
export default {
  props: {
    nav: {
      type: Object,
      required: true,
    },
  },
  data() {
    return {
      isActive: true,
      isOpen: -1,
    };
  },
};
</script>

<!-- Add "scoped" attribute to limit CSS to this component only -->
<style scoped lang="scss">
@import '../assets/style/globals.scss';

a.router-link-exact-active {
  background: $theme-color-accent-cool-light;
}

a.cve-subSectionHasChildren {
  display: inline-block !important;
  padding-top: 8px;
  padding-bottom: 8px;
  padding-right: 2px;
}

::v-deep .collapse-trigger {
  display: inline !important;
}

.menu-list a,
.menu-list .cve-toc-subSection-header,
.collapse {
  display: inline;
}

.menu-label, .menu-list {
    text-align:  left;
}

.menu-label {
    margin-bottom: 8px;
}

.menu-list li {
  padding: 0.5em 0.75em;
}

.menu {
    background: white;
    border: 1px solid gray;
    padding: 16px;
    margin-top: unset;
    border-radius: 2px;
}

ol { counter-reset: item; }
ol li {display: block;}
ol li:before { content: counters(item, ".");
            counter-increment: item;
          }

</style>
