<template>
  <div class="field has-addons is-grouped-right">
    <div class="control is-expanded has-icons-right">
        <input v-model="cveId" @keyup.enter="saveId" class="input cve-button" type="text" placeholder="Enter CVE ID">
      </div>
      <div class="field is-grouped is-grouped-right">
        <button class="button cve-button" style="margin-left: 2px;" @click="saveId">
          <span class="icon is-small is-left">
            <p id="searchIcon" class="is-hidden">search</p>
            <font-awesome-icon icon="search" aria-labelledby="searchIcon" aria-hidden="false" />
          </span>
        </button>
      </div>
    </div> <!-- end search field groups -->
</template>

<script>
import cveRecordLookupMixins from '../mixins/cveRecordLookupMixins';

export default ({
  data() {
    return {
      cveId: this.$store.state.cveId,
    };
  },
  created() {
    const fullPathArr = this.$route.fullPath.split('id=');
    if (fullPathArr.length === 2 && this.isInitialState) {
      const cveId = fullPathArr[1];
      this.$store.state.cveId = cveId;
      this.cveId = cveId;
      this.lookupId();
    }
  },
  methods: {
    saveId() {
      this.$store.commit('setCVEId', this.cveId.trim());

      this.lookupId();
    },
    isInitialState() {
      return !!((this.$store.state.cveId.length === 0 && !this.$store.state.error
      && Object.keys(this.$store.state.cveRecord).length === 0 && this.$store.state.cveRecord.constructor === Object));
    },
  },
  mixins: [cveRecordLookupMixins],
});
</script>

<style scoped lang="scss">
@import '../assets/style/globals.scss';
</style>
