<template>
  <div class="vulnerability-form">
   <div class="vf-inner">
    <h1>Identify a New Vulnerability</h1>
    <div class="field required">
      <label class="label">Your Email Address</label>
      <div class="control">
        <input class="input" type="email" placeholder="Enter a valid e-mail where we can reach you">
      </div>
    </div>
    <div class="field required">
      <label class="label">Number of Vulnerabilities</label>
      <div class="control">
        <div class="select">
          <select>
            <option value="1" selected="selected">1</option>
            <option value="2">2</option>
            <option value="3">3</option>
            <option value="4">4</option>
            <option value="5">5</option>
            <option value="6">6</option>
            <option value="7">7</option>
            <option value="8">8</option>
            <option value="9">9</option>
            <option value="10">10</option>
          </select>
        </div>
      </div>
    </div>
    <div class="field required">
      <label class="label">Vulnerability Type</label>
      <div class="control">
        <div class="select">
          <select>
            <option value="Buffer Overflow">Buffer Overflow</option>
            <option value="Cross Site Request Forgery (CSRF)">Cross Site Request Forgery (CSRF)</option>
            <option value="Cross Site Scripting (XSS)">Cross Site Scripting (XSS)</option>
            <option value="Directory Traversal">Directory Traversal</option>
            <option value="Incorrect Access Control">Incorrect Access Control</option>
            <option value="Insecure Permissions">Insecure Permissions</option>
            <option value="Integer Overflow">Integer Overflow</option>
            <option value="Missing SSL Certificate Validation">Missing SSL Certificate Validation</option>
            <option value="SQL Injection">SQL Injection</option>
            <option value="XML External Entity (XXE)">XML External Entity (XXE)</option>
            <option value="Other or Unknown">Other or Unknown</option>
          </select>
        </div>
      </div>
    </div>
    <div class="field required">
       <b-field label="Vendor">
          <b-autocomplete
              v-model="vendor"
              :data="filteredVendorArray"
              placeholder="Enter the Vendor of the Product (e.g. Microsoft Corporation)"
              @select="option => selected = option">
              <template slot="empty">No results found</template>
          </b-autocomplete>
      </b-field>
    </div>
   
    <div class="field required">
      <label class="label">Affected Products or Codebase</label>
      <div class="product-list">
        <div class="product-element pe-title">
          <div class="pe-product">Product</div>
          <div class="pe-product">Version</div>
          <div class="pe-remove">
            <div class="pe-remove-button" style="visibility: hidden;" v-on:click="confirmDeleteProduct(index)">
              <svg width="12" height="12">
                <g>
                  <line class="primary-stroke" x1="11" y1="1" x2="1" y2="11"/>
                  <line class="primary-stroke" x1="11" y1="11" x2="1" y2="1"/>
                </g>
              </svg>
              Remove
            </div>
          </div>
        </div>
        <div class="product-element" v-for="(p, index) in specifiedProducts">
          <div class="pe-product">
            <b-autocomplete
              v-model="p.product"
              :data="filteredProductArray(index)"
              placeholder="Enter the affected Product (e.g. Word)"
              @select="option => selected = option">
              <template slot="empty">No results found</template>
            </b-autocomplete>
          </div>
          <div class="pe-version">
            <input class="input" type="text" v-model="p.version" />
          </div>
          <div class="pe-remove">
            <div class="pe-remove-button" v-on:click="confirmDeleteProduct(index)">
              <svg width="12" height="12">
                <g>
                  <line class="primary-stroke" x1="11" y1="1" x2="1" y2="11"/>
                  <line class="primary-stroke" x1="11" y1="11" x2="1" y2="1"/>
                </g>
              </svg>
              Remove
            </div>
          </div>
        </div>
        <div class="product-add">
          <a class="pa-button" v-on:click="addProduct()">+ Add Product</a>
        </div>
      </div>
    </div>
    <div class="field required">
      <label class="label">Has vendor confirmed or acknowledged the vulnerability?</label>
      <div class="control">
        <label class="radio">
          <input type="radio" name="answer">
          Yes
        </label>
        <label class="radio">
          <input type="radio" name="answer">
          No
        </label>
      </div>
    </div>
    <div class="field required">
      <label class="label">Attack Type</label>
      <div class="select">
       <select>
        <option value="Context-dependent">Context-dependent</option>
        <option value="Local">Local</option>
        <option value="Physical">Physical</option>
        <option value="Remote">Remote</option>
        <option value="Other">Other</option>
       </select>
      </div>
    </div>
    <div class="field required">
      <label class="label">Impact</label>
      <div class="control">
        <label class="checkbox">
          <input type="checkbox">
            Code Execution
        </label><br>
        <label class="checkbox">
          <input type="checkbox">
            Information Disclosure
        </label><br>
        <label class="checkbox">
          <input type="checkbox">
          Denial of Service
        </label><br>
        <label class="checkbox">
          <input type="checkbox">
           Escalation of Privileges
        </label><br>
        <label class="checkbox">
          <input type="checkbox">
          Other
        </label>
      </div>
    </div>
    <div class="field required">
      <label class="label">Affected components</label>
      <div class="control">
        <textarea class="textarea" placeholder="Please separate with commas. Examples of affected components: affected source code file, affected function, affected executable, etc."></textarea>
      </div>
    </div>
    <div class="field required">
      <label class="label">Attack vectors</label>
      <div class="control">
        <textarea class="textarea" placeholder="What are the methods of exploitation? Example: to exploit vulnerability, someone must open a crafted JPEG file."></textarea>
      </div>
    </div>
    <div class="field required">
      <label class="label">Description of the Vulnerability</label>
      <div class="control">
        <textarea class="textarea" placeholder=""></textarea>
      </div>
    </div>
    <div class="field required">
      <label class="label">Discoverers/Credits</label>
      <div class="control">
        <input class="input" type="text" placeholder="Individual(s) or organization(s) that found the vulnerability or reported the vulnerability to you.">
      </div>
    </div>
    <div class="field required">
      <label class="label">Description of the Vulnerability</label>
      <div class="control">
        <textarea class="textarea" placeholder=""></textarea>
      </div>
    </div>
    <div class="field required">
      <label class="label">References</label>
      <div class="control">
        <textarea class="textarea" placeholder=""></textarea>
      </div>
    </div>
    <div class="field required">
      <label class="label">Additional Information</label>
      <div class="control">
        <textarea class="textarea" placeholder=""></textarea>
      </div>
    </div>
   </div><!-- .vf-inner -->
  </div><!-- .vulnerability-form -->
</template>

<script>

export default {
  name: 'VulnerabilityForm',
  props: {
    msg: String,
  },
  data: function() {
    return {
      vendors: [
          'Adobe Systems Incorporated',
          'Airbus',
          'Alibaba, Inc.',
          'Android (associated with Google Inc. or Open Handset Alliance)',
          'Apache Software Foundation',
          'Apple Inc.',
          'Appthority',
          'Asea Brown Boveri Ltd. (ABB)',
          'Atlassian',
          'Autodesk',
          'Avaya, Inc.',
          'Bitdefender',
          'BlackBerry',
          'Robert Bosch GmbH',
          'Brocade Communications Systems, LLC',
          'Canonical Ltd.',
          'CA Technologies - A Broadcom Company',
          'CERT/CC',
          'Check Point Software Technologies Ltd.',
          'Cisco Systems, Inc.',
          'Cloudflare, Inc.',
          'CyberSecurity Philippines - CERT',
          'Dahua Technologies',
          'Debian GNU/Linux',
          'Dell',
          'Document Foundation, The',
          'Drupal.org',
          'Eaton',
          'Eclipse Foundation',
          'Elastic',
          'F5 Networks',
          'Facebook, Inc.',
          'Fedora Project',
          'Flexera Software LLC',
          'floragunn GmbH',
          'Forcepoint',
          'Fortinet, Inc.',
          'FreeBSD',
          'GitHub, Inc.',
          'Google Inc.',
          'HackerOne',
          'Hangzhou Hikvision Digital Technology Co., Ltd.',
          'HCL Software',
          'Hewlett Packard Enterprise (HPE)',
          'Hillstone Networks, Inc.',
          'HP Inc.',
          'Huawei Technologies',
          'IBM Corporation',
          'ICS-CERT',
          'Intel Corporation',
          'Internet Systems Consortium (ISC)',
          'Jenkins Project',
          'Johnson Controls',
          'JPCERT/CC',
          'Juniper Networks, Inc.',
          'Kaspersky',
          'KrCERT/CC',
          'Kubernetes',
          'Larry Cashdollar',
          'Lenovo Group Ltd.',
          'MarkLogic Corporation',
          'McAfee',
          'Micro Focus International',
          'Microsoft Corporation',
          'MITRE Corporation',
          'MongoDB, Inc.',
          'Mozilla Corporation',
          'Naver Corporation',
          'NetApp, Inc.',
          'Netflix, Inc.',
          'Node.js',
          'NVIDIA Corporation',
          'Objective Development Software GmbH',
          'Odoo',
          'OpenSSL Software Foundation',
          'OPPO Mobile Telecommunication Corp., Ltd.',
          'Oracle',
          'OTRS AG',
          'Palo Alto Networks, Inc.',
          'PHP Group',
          'Pivotal Software, Inc.',
          'Puppet',
          'QNAP Systems, Inc.',
          'Qualcomm, Inc.',
          'Rapid7, Inc.',
          'Red Hat, Inc.',
          'Salesforce, Inc.',
          'SAP SE',
          'Schneider Electric SE',
          'SICK AG',
          'Siemens',
          'Snyk',
          'SonicWall, Inc.',
          'Splunk Inc.',
          'SUSE',
          'Symantec Corporation',
          'Synology Inc.',
          'Talos',
          'Tenable Network Security, Inc.',
          '360 Security Technology, Inc.',
          'TIBCO Software Inc.',
          'Tigera, Inc.',
          'Trend Micro, Inc.',
          'TWCERT/CC',
          'VMware',
          'Yandex N.V.',
          'Zephyr Project',
          'Zero Day Initiative',
          'ZTE Corporation'
      ],
      products: [
        "Microsoft Access",
        "Microsoft Excel",
        "Microsoft OneNote",
        "Microsoft Outlook",
        "Microsoft Power BI",
        "Microsoft PowerPoint",
        "Microsoft Project",
        "Microsoft Publisher",
        "Microsoft Sway",
        "Microsoft Teams",
        "Microsoft Visio",
        "Microsoft Word",
        "Outlook Web App",
        "Skype for Business",
        "Microsoft Azure",
        "Microsoft BackOffice Server",
        "Microsoft BizTalk Server",
        "Microsoft Commerce Server",
        "Microsoft Content Management Server",
        "Microsoft Exchange Server",
        "Microsoft Host Integration Server",
        "Microsoft Identity Integration Server",
        "Microsoft Merchant Server",
        "Microsoft Site Server",
        "Microsoft SharePoint",
        "Microsoft Office PerformancePoint Server",
        "Microsoft Project Server",
        "Microsoft Office Project Portfolio Server",
        "Microsoft Speech Server",
        "Microsoft SQL Server",
        "Microsoft Virtual Server",
        "Search Server",
        "Skype for Business Server",
        "Windows Admin Center",
        "AutoCollage 2008",
        "Microsoft Digital Image",
        "Microsoft Expression Studio",
        "Microsoft Picture It!",
        "Windows Live Movie Maker",
        "Windows Media Encoder",
        "Windows Media Center",
        "Microsoft Research Image Composite Editor",
        "Photo Story",
        "Photosynth",
        "Creative Writer",
        "Encarta",
        "Microsoft Mathematics",
        "Microsoft Student",
        "Microsoft Anti-Virus",
        "Microsoft Security Essentials",
        "Microsoft Desktop Optimization Pack",
        "SyncToy",
        "Windows SteadyState",
        "Windows Live OneCare",
        "Windows NT",
        "Windows CE",
        "Windows Embedded",
        "Windows Mobile",
        "Windows Phone",
        "Windows Preinstallation Environment",
        "Windows Server",
        "Windows 95",
        "Windows 98",
        "Windows ME",
        "Windows 2000",
        "Windows XP",
        "Windows Server 2003",
        "Windows Server 2008",
        "Windows Server 2012",
        "Windows Server 2016",
        "Windows Server 2019",
        "Windows Vista",
        "Windows 7",
        "Windows 8",
        "Windows RT",
        "Windows 8.1",
        "Windows RT 8.1",
        "Windows 10"
      ],
      vendor: '',
      product: '',
      specifiedProducts: [
        {
          product: '',
          version: ''
        }
      ],
      version: '',
      selected: null
    }
  },
  mounted: function() {
    window.vf = this;
  },
  methods: {
    confirmDeleteProduct: function(index) {
      var cfm;
      if(this.specifiedProducts[index].product.trim() === '') {
       cfm = confirm('Really delete this product?');
      } else {
       cfm = confirm('Really delete the product "' + this.specifiedProducts[index].product + '"?');
      }
      if(cfm) {
        this.removeProduct(index);
      }
    },
    removeProduct: function(index) {
      this.specifiedProducts.splice(index, 1);
    },
    addProduct: function() {
      this.specifiedProducts.push({product: '', version: ''});
    },
    /**
     * Filters products on the vendor (this.vendor) and product (this.product)
     * TODO: use fuzzy matching via npm did-you-mean (Levenshtein distance) instead of indexOf
     * TODO: instead of master list use sublists that are dynamically fetched based on the vendor
     */
    filteredProductArray(index) {
      var self = this;
        return this.products.filter((option) => {
          console.log(self.specifiedProducts[index].product);
            return (self.specifiedProducts && self.specifiedProducts[index])?(option
                .toString()
                .toLowerCase()
                .indexOf(self.specifiedProducts[index].product.toLowerCase()) >= 0):false;
        })
    }
  },
  computed: {
    /**
     * Filters vendors based on text entered (this.vendor)
     * TODO: use fuzzy matching via npm did-you-mean (Levenshtein distance) instead of indexOf
     */
      filteredVendorArray() {
          return this.vendors.filter((option) => {
              return option
                  .toString()
                  .toLowerCase()
                  .indexOf(this.vendor.toLowerCase()) >= 0
          })
      }
  }
};
</script>

<style scoped lang="scss">
  @import '../assets/style/globals';


  .vf-inner {
    margin: auto;
    max-width: $max-width;
    padding: 0;
    margin-bottom: 50px;
  }

  .product-element {    
    display: flex;
    align-items: center;
    margin-bottom: 10px;
  }

  .pe-product,
  .pe-version
   {
    flex-grow: 2;
    margin-right: 10px;
  }

  .pe-remove {
    margin-right: 10px;
    white-space: nowrap;
  }

  .pe-remove-button {
    cursor: pointer;
  }

  .pe-remove-button:hover {
    opacity: 0.5;
  }

</style>
