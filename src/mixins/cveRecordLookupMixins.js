import axios from 'axios';

export default {
  methods: {
    resetStates() {
      this.$store.commit('setError', false);
      this.$store.commit('setIsLoading', true);
      this.$store.commit('setRecordData', {});
      this.$store.commit('setServerError', false);
    },
    lookupId() {
      const self = this;
      this.resetStates();

      const url = `https://api.github.com/search/code?q=${this.$store.state.cveId}+repo:CVEProject/cvelist+extension:json`;
      console.log('url ', url);

      axios
        // TO DO: replace w/ CVE Services endpoint
        .get(url, { timeout: 30000 })
        .then((res) => {
          if (res.data.total_count < 1) {
            self.$store.commit('setError', true);
          } else if (res.data.total_count === 1) {
            self.$store.commit('setRecordData', res.data.items);
          } else {
            self.$store.commit('setRecordData', res.data.items.splice(0, 10));
          }

          self.$store.commit('setIsLoading', false);
        })
        .catch(() => {
          this.$store.commit('setServerError', true);
        })
        .finally(() => {
          if (this.$route.name !== 'CVERecord') this.$router.push(`/CVERecord?id=${this.$store.state.cveId}`);
        });
    },
  },
};
