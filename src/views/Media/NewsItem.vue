<template>
  <div id="cve-secondary-page-main-container">
    <div class="columns is-centered">
      <div class="column is-7">
        <main id="cve-main-page-content" role="main">
          <div class="content" v-if="typeof newsItem === 'undefined'">
            <h1 class="title">News item not found.</h1>
          </div>
          <div class="content" v-else>
            <h1 class="title">{{newsItem.title}}</h1>
            <span class ="level is-mobile has-text-grey-dark mb-3">
              <div class ="level-left">
                <span class ="level-item tag is-rounded has-text-grey-dark is-capitalized">{{newsItem.newsType}}</span>
                <time class ="level-item" :datetime="newsItem.date">{{formatDate(newsItem.date)}}</time>
              </div>
            </span>
            <p class="ml-2" v-if="newsItem.newsType == 'blog'">By {{newsItem.author.name}}
              <span class="pl-1" v-if="newsItem.author.organization.name !== 'CVE'">,
                <a class="pl-1" :href="newsItem.author.organization.url" v-if="newsItem.author.organization.name !== 'CVE'">
                  {{newsItem.author.organization.name}}
                </a>
                <span>, {{newsItem.author.title}}</span>
              </span>
            </p>
            <div class="content ml-2 mt-6">
              <span v-for="(section, index) in newsItem.description" :key="index">
              <p v-if="section.contentnewsType == 'paragraph'" v-html="section.content"></p>
              <blockquote v-if="section.contentnewsType == 'quote'">{{section.content}}</blockquote>
              <figure v-if="section.contentnewsType == 'video'" class="media-left image is3by2">
                <iframe class="has-ratio" :src="section.content" frameborder="0" allowfullscreen>
                </iframe>
              </figure>
              <figure v-if="section.contentnewsType == 'image'" class="image is-2by1" >
                <img :src="`/images/${section.content}`" :alt="section.imgAltText">
              </figure>
              </span>
            </div>
          </div>
        </main>
      </div>
    </div>
  </div>
</template>

<script>
import newsData from '@/assets/data/news.json';

export default {
  name: 'NewsItem',
  computed: {
    newsItem() {
      const urlParameters = this.$route.params;
      return newsData.find((newsItem) => {
        if (newsItem.newsType === urlParameters.newsType && newsItem.id.toString() === urlParameters.id) return true;
        return null;
      });
    },
  },
  methods: {
    formatDate(newsDate) {
      const yyyymmdd = newsDate.split('-');
      const formattedDate = new Date();
      formattedDate.setFullYear(parseInt(yyyymmdd[0], 10));
      formattedDate.setMonth(parseInt(yyyymmdd[1] - 1, 10));
      formattedDate.setDate(parseInt(yyyymmdd[2], 10));
      const options = { year: 'numeric', month: 'long', day: 'numeric' };
      return formattedDate.toLocaleDateString(undefined, options);
    },
  },
};

</script>

<style scoped lang="scss">
@import '../../assets/style/globals.scss';

</style>
