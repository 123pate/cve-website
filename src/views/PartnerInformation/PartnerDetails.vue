<template>
  <div id="cve-secondary-page-main-container">
    <div class="columns is-centered">
      <div class="column is-6-desktop is-12-tablet">
        <main id="cve-main-page-content" role="main">
          <div class="content">
            <h1 class="title">{{partner.organizationName}}</h1>
            <div class="tile is-ancestor cve-task-tiles-container">
              <div class="tile is-parent">
                <article class="tile is-child cve-border-dark-blue" v-if="partner.CNA.role.length > 0">
                  <h2 class="title cve-task-tile-header is-size-4">Scope</h2>
                  <p class="tile-body">{{partner.scope}}</p>
                </article>
                <article class="tile is-child cve-border-dark-blue" v-if="Object.keys(partner.securityAdvisories).length > 0">
                  <h2 class="title cve-task-tile-header is-size-4 is-3">Security Advisories</h2>
                  <ul class="tile-body cve-task-tile-list mb-0">
                    <li class="cve-task-tile-list-item" v-for="(alert, index) in partner.securityAdvisories.alerts"
                      :key="partner.shortName + 'alert' + index">
                      <a :href="alert.url">View {{alert.label}}</a>
                    </li>
                  </ul>
                  <ul class="tile-body cve-task-tile-list mt-0">
                    <li class="cve-task-tile-list-item" v-for="(advisories, index) in partner.securityAdvisories.advisories"
                      :key="partner.shortName + 'advisories' + index">
                      <a :href="advisories.url">View {{advisories.label}}</a>
                    </li>
                  </ul>
                </article>
              </div>
            </div>
            <div class="tile is-ancestor cve-task-tiles-container">
              <div class="tile is-parent">
                <article class="tile is-child cve-border-dark-blue" v-if="partner.CNA.role.length > 0">
                  <h2 class="title cve-task-tile-header is-size-4">Program Role</h2>
                  <ul class="tile-body cve-task-tile-list">
                    <li class="cve-task-tile-list-item" v-for="role in partner.CNA.role" :key="role">{{role}}</li>
                  </ul>
                </article>
                <article class="tile is-child cve-border-dark-blue" v-if="partner.CNA.type.length > 0">
                  <h2 class="title cve-task-tile-header is-size-4">Organization Type</h2>
                  <ul class="tile-body cve-task-tile-list" v-if="partner.CNA.type.length > 0">
                    <li class="cve-task-tile-list-item" v-for="type in partner.CNA.type" :key="type">{{type}}</li>
                  </ul>
                </article>
              </div>
            </div>
            <h2 class="title">Report a vulnerability</h2>
            <div class="timeline">
              <header class="timeline-header">
                <span class="tag is-medium">Start</span>
              </header>
              <div class="timeline-item">
                <div class="timeline-marker">1</div>
                <div class="timeline-content">
                  <h3 class="title">Read disclosure policy</h3>
                    <ul class="tile-body cve-task-tile-list mb-0" v-if="partner.disclosurePolicy.length > 0">
                      <li class="cve-task-tile-list-item" v-for="(disclosurePolicy, index) in partner.disclosurePolicy"
                        :key="partner.shortName + 'disclosurePolicy' + index">
                        <span><a :href="disclosurePolicy.url">View {{disclosurePolicy.label}}
                          <span v-if="disclosurePolicy.language != 'English'">({{disclosurePolicy.language}})</span></a>
                        </span>
                      </li>
                    </ul>
                    <p v-else class="tile-body">N/A</p>
                </div>
              </div>
              <div class="timeline-item">
                <div class="timeline-marker">2</div>
                <div class="timeline-content">
                  <h3 class="title">Contact</h3>
                  <div v-for="(contact, index) in partner.contact" :key="partner.shortName+'contact'+index">
                    <ul class="tile-body cve-task-tile-list mb-0" v-if="contact.email.length > 0">
                      <li class="cve-task-tile-list-item" v-for="(email, index) in contact.email" :key="partner.shortName + 'email' + index">
                        <span v-if="email.label == email.emailAddr">Email <a :href="'mailto:' + email.emailAddr"> {{email.label}}</a></span>
                        <span v-else><a :href="'mailto:' + email.emailAddr"> {{email.label}}</a></span>
                      </li>
                    </ul>
                    <ul class="tile-body cve-task-tile-list mb-0" v-if="contact.form.length > 0">
                      <li class="cve-task-tile-list-item" v-for="(form, index) in contact.form" :key="partner.shortName + 'form' + index">
                        <a :href="form.url"> {{form.label}}</a>
                      </li>
                    </ul>
                    <ul class="tile-body cve-task-tile-list mb-0" v-if="contact.contact.length > 0">
                      <li class="cve-task-tile-list-item" v-for="(contactPage, index) in contact.contact"
                        :key="partner.shortName + 'contactPage' + index">
                        <a :href="contactPage.url"> {{contactPage.label}}</a>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
              <footer class="timeline-header">
                <span class="tag is-medium">End</span>
              </footer>
            </div>

          </div>
        </main>
      </div>
    </div>
  </div>
</template>

<script>
import partnersList from '@/assets/data/CNAsList.json';

export default {
  computed: {
    partner() {
      const { shortName } = this.$route.params;
      return partnersList.find((partner) => partner.shortName === shortName);
    },
  },
};
</script>

<style scoped lang="scss">
@import '@/assets/style/globals.scss';
@import 'bulma';
@import 'bulma-timeline';

.tile.is-child.cve-task-tile {
  margin: 0.5rem !important;
}
</style>
