<template>
<div>
  <main id="cve-homepage-main-content" role="main">
  <section class="hero" >
    <div class="hero-body">
    <div class="container cve-mission-container">
      <h2 class="title">
        CVE Program Mission
      </h2>
      <p id="cve-mission-text" class="subtitle">
        Identify and define publicly disclosed cybersecurity vulnerabilities.
        <button v-if="cveRecordsLoading" class="button is-loading cve-margin-top-neg7"></button>
        <span v-if="!cveRecordsLoading && !cveRecordsRequestErrored"><router-link to="/Download">
          Access {{cveRecordsTotal}}</router-link> CVE Records.
        </span>
      </p>
      <div class ="notification is-info" v-if="cveRecordsRequestErrored" role="alert">Total count of CVE records is currently unavailable.
        Please <a href="https://cveform.mitre.org/" target="_blank">report the issue</a> and try again later. Sorry for the inconvenience.</div>
    </div>
    </div>
  </section>

  <div id="cve-homepage-columns-container" class="container">
    <HomeModule/>
  </div>
  </main>

</div>
</template>

<script>
import HomeModule from '@/components/HomeModule.vue';
import axios from 'axios';

export default {
  name: 'Home',
  components: {
    HomeModule,
  },
  data() {
    return {
      cveRecordsTotal: 0,
      cveRecordsLoading: true,
      cveRecordsRequestErrored: false,
    };
  },
  mounted() {
    axios
      .get('https://cve.mitre.org/data/downloads/all-cve-COUNT.html')
      .then((res) => {
        this.cveRecordsTotal = res;
      })
      .catch(() => {
        this.cveRecordsRequestErrored = true;
      })
      .finally(() => {
        this.cveRecordsLoading = false;
      });
  },
};
</script>

<style scoped lang="scss">
@import '@/assets/style/globals.scss';

.hero {
  background: white;
  border-bottom: 0.5px solid $theme-color-base-lighter;
}

.hero-body {
  padding: 1.5rem 1rem;
}
.container.cve-mission-container {
  background: white;
  text-align: center;
}

.cve-margin-top-neg7 {
  margin-top: -7px !important;
}
</style>
