<template>
<div>
  <main id="cve-main-page-content" role="main">
  <section class="hero" >
    <div class="hero-body">
    <div class="container cve-mission-container mt-1">
      <h1 class="title is-hidden">Common Vulnerabilities and Exposures (CVE)</h1>
      <h2 class="title cve-heading-top-spacing">
        CVE Program Mission
      </h2>
      <div id="cve-mission-text" class="subtitle">
        Identify, define, and catalog publicly disclosed cybersecurity vulnerabilities
        <button v-if="cveRecordsLoading" class="button is-loading cve-margin-top-neg7"></button>
        <p class="subtile mt-2" v-if="!cveRecordsLoading && !cveRecordsRequestErrored">
          Currently, there are <span class="has-text-weight-bold">{{cveRecordsTotal}}</span> CVE Records accessible via
          <router-link to="/Download">Download</router-link> or
          <span class="icon-text">
            <a href="https://cve.mitre.org/cve/search_cve_list.html">Search
              <span class="icon cve-icon-xxs">
                <p id="externalLinkIcon" class="is-hidden">external website</p>
                <font-awesome-icon icon="external-link-alt"
                 aria-labelledby="externalLinkIcon" aria-hidden="false"/>
              </span>
            </a>
          </span>
        </p>
      </div>
      <div class="notification is-warning" role="alert" v-if="cveRecordsRequestErrored">
        <div class="is-flex" style="justify-content: center;">
          <p id="alertIcon" class="is-hidden">alert</p>
          <font-awesome-icon style="flex: 0 0 40px;" size="1x"  icon="exclamation-triangle" role="alert"
            aria-labelledby="alertIcon" aria-hidden="false" />
          <p>
            Total count of CVE records is currently unavailable. Please
            <span class="icon-text">
              <a href="https://cveform.mitre.org/" target="_blank">report the issue
                <span class="icon is-size-7 cve-icon-xxs">
                  <p id="extenalLink1" class="is-hidden">external site</p>
                  <font-awesome-icon icon="external-link-alt" aria-labelledby="extenalLink1" aria-hidden="false" focusable="false"/>
                </span>
              </a>
            </span>
            and try again later. Sorry for the inconvenience.
          </p>
        </div>
      </div>
    </div>
    </div>
  </section>

  <div id="cve-homepage-columns-container" class="container">
    <HomeModule/>
  </div>
  </main>

</div>
</template>

<script>
import HomeModule from '@/components/HomeModule.vue';
import axios from 'axios';

export default {
  name: 'Home',
  components: {
    HomeModule,
  },
  data() {
    return {
      cveRecordsTotal: 0,
      cveRecordsLoading: true,
      cveRecordsRequestErrored: false,
    };
  },
  mounted() {
    axios
      .get('https://cve.mitre.org/data/downloads/all-cve-COUNT.html')
      .then((res) => {
        this.cveRecordsTotal = res;
      })
      .catch(() => {
        this.cveRecordsRequestErrored = true;
      })
      .finally(() => {
        this.cveRecordsLoading = false;
      });
  },
};
</script>

<style scoped lang="scss">
@import '@/assets/style/globals.scss';

.hero {
  background: white;
  border-bottom: 0.5px solid $theme-color-base-lighter;
}

.hero-body {
  padding: 1.5rem 1rem;
}
.container.cve-mission-container {
  background: white;
  text-align: center;
}

.cve-margin-top-neg7 {
  margin-top: -7px !important;
}
</style>
